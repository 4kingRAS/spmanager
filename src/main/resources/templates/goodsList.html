<div class="contentDiv">
    <div id="goodsTable" th:fragment="goodsTable">
        <table class="table table-hover table-condensed">
            <legend>
                <strong><p class="text">商品列表</p></strong>
            </legend>

            <thead>
            <tr>
                <th>商品编号</th>
                <th>商品类别</th>
                <th>商品名称</th>
                <th>进货价(元)</th>
                <th>代理价(元)</th>
                <th>市场价(元)</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="goods : ${goodsList}">
                <th scope="row"  th:text="${goods.id}"></th>
                <td th:text="${goods.type}"></td>
                <td>
                    <span th:text="${goods.name}"></span>
                    <span class="badge" >new~</span>
                </td>
                <td th:text="${goods.priceForBuy}"></td>
                <td th:text="${goods.priceForSell}"></td>
                <td th:text="${goods.priceForMarket}"></td>
                <td class="col-lg-2">
                    <div class="btn-group">
                        <button class="btn btn-primary btn-sm" data-toggle="modal" th:href="'#gx'+${goods.id}">更新</button>
                        <button class="btn btn-danger btn-sm" th:onclick="'javascript:deleteGroup('+${goods.id}+')'">删除</button>
                    </div>
                    <!-- MODAL -->
                    <div class="modal fade" th:id="'gx'+${goods.id}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title" id="myModalLabel">修改群组</h4>
                                </div>
                                <div class="modal-body">
                                    <table class="table table-hover table-condensed">
                                        <legend>
                                            <strong>
                                                <span th:text="'群组ID：'+${goods.id}"></span>
                                            </strong>
                                        </legend>
                                        <thead>
                                        <tr>
                                            <th>群组名</th>
                                            <th>是否我司员工</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <input type="hidden" th:id="'ug'+${goods.id}" th:value="${goods.id}"/>
                                            <td>
                                                <input type="text" th:id="'ugn'+${goods.id}" th:value="${goods.name}"/>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default btn-sm" data-dismiss="modal">关闭</button>
                                        <button type="button" class="btn btn-primary btn-sm" th:onclick="'javascript:updateGroup('+${goods.id}+')'">
                                            提交更改
                                        </button>
                                    </div>
                                </div>
                            </div><!-- /.modal-content -->
                        </div><!-- /.modal -->
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <script type="text/javascript" th:inline="javascript">

        /*<![CDATA[*/
        function addGroup(){
            // 装载局部刷新返回的页面
            var gName = $("#gname").val();
            var ga = "1";
            var gpm = $("input[name='pmsType']:checked").val();
            //is checked?
            if($("#gagent").is(":checked")){
                ga = "0";
            }

            $.ajax({
                url: "/manager?add",
                type: 'post',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({UserGroup: {name: gName, isAgent: ga}, role: gpm}),
                async: false
                // TRUE 异步 FALSE 同步
            });

            $('#grouptb').load("/manager/fresh");
        }

        function deleteGroup(gid){

            $.ajax({
                url: "/manager?delete",
                type: 'post',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({id: gid}),
                async: false
                // TRUE 异步 FALSE 同步
            });

            $('#grouptb').load("/manager/fresh");
        }

        function updateGroup(gi){

            var gid = $("#ug"+gi).val();
            var gname = $("#ugn"+gi).val();
            var gag = "1";
            if($("#uga"+gi).is(":checked")) {
                gag = "0";
            }

            $.ajax({
                url: "/manager?update",
                type: 'post',
                dataType: 'json',
                contentType: 'application/json',
                data: JSON.stringify({id: gid, name: gname, isAgent: gag}),
                async: false
                // TRUE 异步 FALSE 同步
            });
            $("#"+gi).on('hidden.bs.modal', function (e) {
                $('#grouptb').load("/manager/fresh");
            }).modal('hide');
        }
        /*]]>*/
    </script>
</div>